{% extends 'unfold/layouts/base.html' %}

{% load i18n unfold %}

{% block breadcrumbs %}{% endblock %}

{% block title %}
    {% trans 'Dashboard' %} | {{ site_title|default:_('Django site admin') }}
{% endblock %}

{% block content %}
    <div class="flex flex-col gap-8">
        <!-- KPI Section -->
        <div class="grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-4">
            {% for item in kpi %}
                {% component "unfold/components/card.html" with title=item.title footer=item.footer icon=item.icon %}
                    <div class="text-3xl font-bold text-gray-900 dark:text-gray-100">
                        {{ item.metric }}
                    </div>
                {% endcomponent %}
            {% endfor %}
        </div>

        <!-- Charts Section -->
        <div class="grid grid-cols-1 gap-4 lg:grid-cols-1">
             {% component "unfold/components/card.html" with title="Cluster Load Distribution" %}
                <div style="height: 300px;">
                    {% component "unfold/components/chart/bar.html" with data=charts.cluster_load height=300 %}
                    {% endcomponent %}
                </div>
            {% endcomponent %}
        </div>

        <!-- Tables Section -->
        <div class="grid grid-cols-1 gap-4 lg:grid-cols-3">
            <!-- Nodes Status Table (Takes 2/3 width on large screens) -->
            <div class="lg:col-span-2">
                {% component "unfold/components/card.html" with title="System Nodes Status" %}
                    <div class="overflow-x-auto">
                        <table class="min-w-full text-left text-sm whitespace-nowrap">
                            <thead class="uppercase tracking-wider border-b-2 border-gray-200 dark:border-gray-700">
                                <tr>
                                    <th scope="col" class="px-4 py-3 text-gray-500 dark:text-gray-400">Node</th>
                                    <th scope="col" class="px-4 py-3 text-gray-500 dark:text-gray-400">Cluster</th>
                                    <th scope="col" class="px-4 py-3 text-gray-500 dark:text-gray-400">Status</th>
                                    <th scope="col" class="px-4 py-3 text-right text-gray-500 dark:text-gray-400">Attendees</th>
                                    <th scope="col" class="px-4 py-3 text-right text-gray-500 dark:text-gray-400">Meetings</th>
                                    <th scope="col" class="px-4 py-3 text-right text-gray-500 dark:text-gray-400">CPU Load</th>
                                    <th scope="col" class="px-4 py-3 text-right text-gray-500 dark:text-gray-400">Comp. Load</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
                                {% for node in tables.nodes %}
                                <tr class="hover:bg-gray-50 dark:hover:bg-gray-800">
                                    <td class="px-4 py-3 font-medium text-gray-900 dark:text-white">
                                        {{ node.name }}
                                        <div class="text-xs text-gray-500">{{ node.domain }}</div>
                                    </td>
                                    <td class="px-4 py-3 text-gray-500 dark:text-gray-400">{{ node.cluster }}</td>
                                    <td class="px-4 py-3">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-{{ node.status_color }}-100 text-{{ node.status_color }}-800 dark:bg-{{ node.status_color }}-900 dark:text-{{ node.status_color }}-200">
                                            {{ node.status }}
                                        </span>
                                    </td>
                                    <td class="px-4 py-3 text-right text-gray-500 dark:text-gray-400">{{ node.attendees }}</td>
                                    <td class="px-4 py-3 text-right text-gray-500 dark:text-gray-400">{{ node.meetings }}</td>
                                    <td class="px-4 py-3 text-right text-gray-500 dark:text-gray-400">{{ node.cpu_load }}</td>
                                    <td class="px-4 py-3 text-right font-medium text-gray-900 dark:text-white">{{ node.computed_load }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% endcomponent %}
            </div>

            <!-- Active Tenants Table (Takes 1/3 width) -->
            <div class="lg:col-span-1">
                {% component "unfold/components/card.html" with title="Top Active Tenants" %}
                    <div class="overflow-x-auto">
                        <table class="min-w-full text-left text-sm whitespace-nowrap">
                            <thead class="uppercase tracking-wider border-b-2 border-gray-200 dark:border-gray-700">
                                <tr>
                                    <th scope="col" class="px-4 py-3 text-gray-500 dark:text-gray-400">Tenant</th>
                                    <th scope="col" class="px-4 py-3 text-right text-gray-500 dark:text-gray-400">Mtgs</th>
                                    <th scope="col" class="px-4 py-3 text-right text-gray-500 dark:text-gray-400">Att.</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
                                {% for tenant in tables.tenants %}
                                <tr class="hover:bg-gray-50 dark:hover:bg-gray-800">
                                    <td class="px-4 py-3 font-medium text-gray-900 dark:text-white">{{ tenant.name }}</td>
                                    <td class="px-4 py-3 text-right text-gray-500 dark:text-gray-400">{{ tenant.meetings }}</td>
                                    <td class="px-4 py-3 text-right text-gray-500 dark:text-gray-400">{{ tenant.attendees }}</td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="3" class="px-4 py-3 text-center text-gray-500">No active tenants</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% endcomponent %}
            </div>
        </div>
    </div>
{% endblock %}
